name: Deploy (server)

on:
  workflow_run:
    workflows: ["CI"]
    branches: ["master"]
    types: [completed]

concurrency:
  group: deploy-backend
  cancel-in-progress: true

jobs:
  deploy:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: [self-hosted, z159-backend]

    steps:
      - name: Checkout repository
        uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332

      - name: Deploy backend (local on runner)
        shell: bash
        run: |
          set -euo pipefail
          /home/deploy/deploy_backend.sh
