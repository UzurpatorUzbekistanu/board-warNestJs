name: Deploy (server)

on:
  workflow_run:
    workflows: ["CI"]
    branches: ["master"]
    types: [completed]

concurrency:
  group: deploy-backend
  cancel-in-progress: true

jobs:
  deploy:
    runs-on: [self-hosted, Linux, X64, backend]
    steps:
      - name: Checkout repository
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2 pinned

      - name: Deploy backend (local on runner)
        shell: bash
        run: |
          set -euo pipefail
          /home/deploy/deploy_backend.sh
